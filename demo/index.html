<!doctype html>
  <head>
    <link rel='stylesheet' type='text/css' href='demo.css' />
    <script src='https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js'></script>
    <script src='../output/web3c.js'></script>
    <script src='demo.js'></script>
  </head>
  <body>
    <header>
      <h1>Web3.<i>Confidentiality</i></h1>
    </header>
    <aside>
      This demo will interact with the web3 provider at <input type='text' id='provider' value='https://web3.us-west-2.production.oasiscloud.io' />
    </aside>
    <section>
      <h2>Interaction with confidential contracts</h2>
      <code>(this comes last; the high-level interface hiding complexity)</code>
    </section>
    <section>
      <h1>Under the hood</h1>
      <section>
        <h2>Establishing a secure channel</h2>
        <p>
        In the standard mental model of interaction with a smart contract, the
        contract is identified by the address it is deployed on chain. A client
        can validate that it is interacting with the expected contract by
        checking what's deployed at that location, and making sure the code of
        the contract meets expectations.
        </p>
        <p>
        In confidential contracts, an additional step is needed - the client
        must determine the public key with which to encrypt messages to the
        contract. This key is dynamic - it may change over time - meaning that
        a request for the current public key, and associated validation, is
        nessicary at the beginning of each session.
        </p>
        <p>
        The current encryption key for a confidential contract can be
        retrieved by calling <code>confidential_getPublicKey</code> for the contract
        address.
        </p>
        <section id='getpublickey'>
          <h3>confidential_getPublicKey</h3>
          <form id='getpublickey_form'>
            <input type='text' name='contract_address' />
            <input type='submit' name='getPublicKey' value='get public key' />
          </form>
          <span id='getpublickey_result'></span>
        </section>
      </section>
      <section>
        <h2>An encrypted call</h2>
        <p>
        To make a confidential call, the public key above is used to encrypt the
        data field of a standard call. This field contains a reference to which
        method of the contract should be called, along with the arguments.
        </p>
        <p>
        The low-level <code>confidential_call_enc</code> and
        <code>confidential_sendRawTransaction_enc</code> should be
        provided with this encrypted state. It is up to the client to have
        encrypted the call, and gotten a local wallet to sign the resulting
        serialized data.
        </p>
        <section id='call_enc'>
          <h3>confidential_call_enc</h3>
          <form id='call_enc_form'>
            <input type='text' name='contract_address' />
            <input type='text' name='data' />
            <input type='submit' name='call' value='call' />
          </form>
          <span id='call_enc_result'></span>
        </section>
      </section>
    </section>
  </body>
</html>
